<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æœˆä¹‹ç¬¦æ–‡å åœ</title>
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="images/41_èª.png">
  <meta name="theme-color" content="#0d0d0d">
  <style>
    body {
      margin: 0;
      background: #0d0d0d;
      color: #f0f0f0;
      font-family: "Noto Sans TC", sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      overflow: hidden;
    }
    #start, #drawResult, #againBtn, #loading {
      display: none;
    }
    .fade-in {
      animation: fadeIn 2s ease forwards;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    #runeImg {
      max-width: 80vw;
      max-height: 80vh;
	  width: auto;
      height: auto;
	  display: block;
      margin: 0 auto 1rem auto;
      object-fit: contain;
      object-position: center center;
    }
    #drawResult p {
      text-align: left;
      max-width: 90vw;
      margin: 0.5rem auto;
    }
    .footer {
      position: absolute;
      bottom: 1rem;
      font-size: 0.75rem;
      color: #888;
      text-align: center;
    }
  </style>
</head>
<body>
  <div id="splash">
    <img src="images/41_èª.png" class="fade-in" />
  </div>
  <div id="start">
    <p>è«‹å…ˆéœå¿ƒæ€è€ƒä½ æ­¤åˆ»çœŸæ­£æƒ³å•çš„å•é¡Œã€‚</p>
    <button onclick="beginDivination()">é–‹å§‹å åœ</button>
  </div>
  <div id="loading">
    <img src="images/42_æ†¶.png" />
    <p>å‘½é‹è¨˜æ†¶æ­£åœ¨ç‚ºä½ æ•´ç†è¨Šæ¯â€¦</p>
  </div>
  <div id="drawResult">
    <img id="runeImg" src="" />
    <h2 id="runeName"></h2>
    <p id="runeSpell"></p>
    <p id="runeStory"></p>
    <p id="moonPhase"></p>
    <p id="moonDesc"></p>
    <p id="cardDirection"></p>
    <p id="directionDesc"></p>
    <button id="againBtn" onclick="resetApp()">å†æ¬¡å åœ</button>
  </div>
  <div class="footer">
    æ­¤ç³»çµ±ç”±æœˆèªè€… Oscarï¼ˆEsotericVerseï¼‰å‰µä½œä¸¦éˆæ„Ÿå°å¼•<br>
    Â© 2025 æœˆèªä¹‹å¢ƒå·¥ä½œå®¤
  </div>
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js')
        .then(reg => console.log('Service Worker è¨»å†ŠæˆåŠŸ:', reg))
        .catch(err => console.log('Service Worker è¨»å†Šå¤±æ•—:', err));
    }

    const splash = document.getElementById('splash');
    const start = document.getElementById('start');
    const loading = document.getElementById('loading');
    const drawResult = document.getElementById('drawResult');
    const directions = [
      { name: 'æ­£ä½', desc: 'èƒ½é‡é †è¡Œã€‚ä¸»é¡Œè‡ªç„¶æµå‹•ã€åŠ›é‡é¡¯ç¾ã€å¤–é¡¯ç„¡ç¤™ã€‚' },
      { name: 'åŠæ­£ä½', desc: 'åˆç”Ÿæ¼¸é¡¯ã€‚æ½›èƒ½æ­£åœ¨å‡èšã€å°šæœªå®Œå…¨æµå‹•ï¼Œä»£è¡¨æº–å‚™èˆ‡æ­£é–‹å§‹å•Ÿå‹•ã€‚' },
      { name: 'åŠé€†ä½', desc: 'èƒ½é‡é˜»æ»¯ã€‚ä¸»é¡Œåå‘é¡¯ç¾ã€åŠ›é‡æ‰­æ›²ã€æ½›è—æˆ–å±æ©Ÿæ„Ÿæµ®ç¾ã€‚' },
      { name: 'é€†ä½', desc: 'é‡‹æ”¾æ”¶æŸã€‚èƒ½é‡æ­£åœ¨é€€æ½®ã€é€²å…¥æ•´åˆæœŸï¼Œæ˜¯è½‰åŒ–èˆ‡ç™‚ç™’éšæ®µã€‚' }
    ];

    setTimeout(() => {
      splash.style.display = 'none';
      start.style.display = 'block';
    }, 1500);

    async function beginDivination() {
      start.style.display = 'none';
      loading.style.display = 'block';
      await new Promise(resolve => setTimeout(resolve, 3000));

      const now = new Date();
      const response = await fetch('data/runes.json');
      const runes = await response.json();
      const rune = runes[Math.floor(Math.random() * runes.length)];
      const moon = getMoonPhase(now, rune.group);
      const direction = directions[Math.floor(Math.random() * directions.length)];

      loading.style.display = 'none';
      drawResult.style.display = 'block';

      document.getElementById('runeImg').src = rune.image;
      document.getElementById('runeName').textContent = rune.name + ' â€§ ' + rune.symbol;
      document.getElementById('runeSpell').textContent = rune.spell;
      document.getElementById('runeStory').textContent = rune.soul_lesson;
      document.getElementById('moonPhase').textContent = 'ç•¶å‰æœˆç›¸ï¼š' + moon.phase;
      document.getElementById('moonDesc').textContent = moon.description;
      document.getElementById('cardDirection').textContent = 'å¡ç‰‡æ–¹å‘ï¼š' + direction.name;
      document.getElementById('directionDesc').textContent = direction.desc;

      setTimeout(() => {
        document.getElementById('againBtn').style.display = 'block';
      }, 1000);
    }

    function resetApp() {
      drawResult.style.display = 'none';
      document.getElementById('againBtn').style.display = 'none';
      start.style.display = 'block';
    }

    function getMoonPhase(date, group) {
      const lunarDay = new Intl.DateTimeFormat('zh-TW-u-ca-chinese', { day: 'numeric' }).format(date);
      const day = parseInt(lunarDay);
      const isEclipse = group === 'å®‡å®™ç„¡å¸¸';

      if (day >= 1 && day <= 7) {
        return {
          phase: 'ğŸŒ‘ æ–°æœˆæœŸ',
          description: isEclipse
            ? 'æ„åœ–é®è”½ã€‚ä½ è©¦åœ–é‡å•ŸæŸé …é¡˜æœ›ï¼Œå»è¢«æ½›æ„è­˜æœªè§£çš„ææ‡¼æ‰€å¹²æ“¾ã€‚è•è±¡èƒ½é‡è®“ä½ çœ‹ä¸è¦‹çœŸæ­£çš„å‹•æ©Ÿã€‚'
            : 'é©åˆç«‹ä¸‹æ„åœ–ã€å•Ÿå‹•æ–°è¨ˆç•«ï¼Œæ˜¯æ’­ç¨®çš„æ™‚åˆ»ã€‚'
        };
      } else if (day >= 8 && day <= 14) {
        return {
          phase: 'ğŸŒ“ ä¸Šå¼¦æœŸ',
          description: isEclipse
            ? 'å‹•é®è”½ã€‚ä½ æ­£åœ¨æ¡å–è¡Œå‹•ï¼Œä½†èƒ½é‡è»Œé“éŒ¯ç½®ï¼Œéƒ¨åˆ†åŠªåŠ›å°‡é­é‡å¤±æ•ˆæˆ–åé›¢åŸæ„çš„çµæœã€‚è«‹é‡æ–°èšç„¦åˆè¡·ã€‚'
            : 'è€ƒé©—èˆ‡è¡Œå‹•çš„éšæ®µï¼Œéœ€å…‹æœéšœç¤™æŒçºŒå‰é€²ã€‚'
        };
      } else if (day >= 15 && day <= 21) {
        return {
          phase: 'ğŸŒ• æ»¿æœˆæœŸ',
          description: isEclipse
            ? 'å…‰å½±éŒ¯ä½ã€‚çœ‹ä¼¼é¡¯åŒ–çš„æˆæœä¸­ï¼Œæ½›è—æœªé¡¯çš„è®Šå› ã€‚ä½ å¯èƒ½èª¤ä»¥ç‚ºäº‹æƒ…ã€Œåœ“æ»¿ã€ï¼Œå¯¦å‰‡é‡è¦è½‰æŠ˜æ‰å‰›é–‹å§‹ã€‚'
            : 'èƒ½é‡æœ€å¼·ä¹‹æ™‚ï¼Œé©åˆæ”¶å‰²ã€è¦ºå¯Ÿèˆ‡é‡‹æ”¾ã€‚'
        };
      } else if (day >= 22 && day <= 28) {
        return {
          phase: 'ğŸŒ— ä¸‹å¼¦æœŸ',
          description: isEclipse
            ? 'æ¸…ç†å—é˜»ã€‚ä½ æ­£åœ¨é‡‹æ”¾æŸäº›äº‹ç‰©ï¼Œä½†æ·±å±¤æœªè§£çš„ç‰½çµ†æ­£åœ¨å›æµã€‚æƒ…ç·’é‡ç¾ã€è¨˜æ†¶æµ®ç¾ï¼Œæé†’ä½ æœªç«Ÿçš„èª²é¡Œä»åœ¨ã€‚'
            : 'æ•´ç†èˆ‡åæ€çš„æ™‚æœŸï¼Œé‡‹æ”¾ä¸å†éœ€è¦çš„äº‹ç‰©ã€‚'
        };
      } else {
        return {
          phase: 'ğŸŒ˜ ç©ºäº¡æœŸ',
          description: isEclipse
            ? 'æ­¤æ™‚çš„è¨Šæ¯ä¾†è‡ªé«˜ç¶­éˆé­‚æˆ–å®‡å®™æ½›æ„è­˜ï¼Œæ˜¯é‡è¦çš„è½‰åŒ–å¬å–šã€‚'
            : 'èƒ½é‡é€€æ½®ã€å„€å¼é–‰å¹•æœŸï¼Œé©åˆå†¥æƒ³èˆ‡ç›´è¦ºä½œæ¥­ã€‚'
        };
      }
    }
  </script>
</body>
</html>
