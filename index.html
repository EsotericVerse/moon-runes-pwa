<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>月之符文占卜</title>
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="images/41_語.png">
  <meta name="theme-color" content="#0d0d0d">
  <style>
    body {
      margin: 0;
      background: #0d0d0d;
      color: #f0f0f0;
      font-family: "Noto Sans TC", sans-serif;
      height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }
    .container {
      display: flex;
      width: 90vw;
      max-width: 960px;
      height: 90vh;
    }
    .left-panel {
      width: 33%;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 1rem;
    }
    .left-panel img {
      max-width: 100%;
      max-height: 80vh;
      object-fit: contain;
    }
    .right-panel {
      width: 67%;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      padding: 1rem;
    }
    .right-panel p {
      text-align: left;
      line-height: 1.6;
    }
    .button-group {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      margin-top: 2rem;
    }
    button {
      background: #444;
      color: #fff;
      border: none;
      padding: 0.8rem 1.2rem;
      font-size: 1rem;
      cursor: pointer;
    }
    .footer {
      font-size: 0.75rem;
      color: #888;
      text-align: center;
      margin-top: 1rem;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="left-panel">
      <img src="images/41_語.png" id="runeImage" alt="語符文">
    </div>
    <div class="right-panel">
      <div>
        <p id="introText">
          歡迎來到月之符文系統。請先心中想好問題，再按下開始占卜。<br>
          月之符文以月為底，卡片有自己的月相，現在環境有現有月相。<br>
          月之符文，卡片為正方形，所以有四種方向：正位、半正、逆位、半逆。<br>
        </p>
        <p id="repeatWarning" style="display:none; color:#ff8080">
          建議您，重複問題，短時間之內，不要問第二次，否則占卜結果容易失準。
        </p>
      </div>
      <div class="button-group">
        <button id="startButton">開始占卜</button>
        <button id="feedbackButton" style="display:none;">感謝您使用月之符文來觀看命運的軌跡。<br>
          <a href="mailto:esotericverse.xy@gmail.com" style="color:#80d0ff">若有建議歡迎討論</a>
        </button>
      </div>
    </div>
  </div>
  <div class="footer">
    月語之境工作室 原作製作
  </div>

  <script>
    const runeImage = document.getElementById("runeImage");
    const introText = document.getElementById("introText");
    const repeatWarning = document.getElementById("repeatWarning");
    const startButton = document.getElementById("startButton");
    const feedbackButton = document.getElementById("feedbackButton");

    let hasDrawn = false;

    function getMoonPhaseText(date) {
      const lunarDay = date.getDate(); // 模擬農曆轉換
      if (lunarDay >= 1 && lunarDay <= 7) return "新月";
      if (lunarDay >= 8 && lunarDay <= 14) return "上弦";
      if (lunarDay >= 15 && lunarDay <= 21) return "滿月";
      if (lunarDay >= 22 && lunarDay <= 28) return "下弦";
      return "空亡";
    }

    function getRandomDirection() {
      const directions = ["正位", "半正", "逆位", "半逆"];
      return directions[Math.floor(Math.random() * directions.length)];
    }

    function startDivination() {
      // 切換語 -> 憶
      runeImage.src = "images/42_憶.png";

      const now = new Date();
      const moonText = getMoonPhaseText(now);
      const notice = `\u76ee\u524d\u6708\u76f8\u70ba：${moonText}`;
      const explain = "正在嘗試為您觀看命運的痕跡，快好了。請稍後...";

      introText.innerHTML = `${notice}<br>
      月之符文以月為底，卡片有自己的月相，現在環境有現有月相。<br>
      月之符文，卡片為正方形，所以有四種方向：正位、半正、逆位、半逆。<br><br>${explain}`;

      setTimeout(() => {
        showResult();
      }, 5000);
    }

    function showResult() {
      const drawnRune = "images/01_\u9748.png"; // 之後改為隨機
      const direction = getRandomDirection();

      runeImage.src = drawnRune;
      introText.innerHTML = `相位為：${direction}<br><br>
        （這裡是抽出的卡片說明文字，未來將根據 json 資料載入）`;

      feedbackButton.style.display = "block";
      startButton.textContent = "重新占卜";
      repeatWarning.style.display = hasDrawn ? "block" : "none";
      hasDrawn = true;
    }

    startButton.onclick = startDivination;
  </script>
</body>
</html>
