<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>æœˆä¹‹ç¬¦æ–‡å»ºè­°ç”Ÿæˆå™¨</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 2rem;
      background: #f0f4f8;
    }
    .input-box, .suggestion-box {
      background: #fff;
      padding: 1rem;
      border-radius: 8px;
      margin-bottom: 1rem;
      box-shadow: 0 0 10px rgba(0,0,0,0.05);
    }
    h1 { color: #4a3e91; }
    .suggestion-box h3 { margin: 0.5rem 0 0.2rem; color: #5a4a91; }
  </style>
</head>
<body>
  <h1>ğŸŒ™ æœˆä¹‹ç¬¦æ–‡ LLM å»ºè­°ç”Ÿæˆå™¨</h1>

  <div class="input-box">
    <label for="input-prompt">è¼¸å…¥ç›®å‰çš„ç‹€æ…‹å¥ï¼š</label><br />
    <input id="input-prompt" style="width:100%; padding:0.5rem;" value="æˆ‘æ­£åœ¨æº–å‚™ç››é–‹ï¼Œå…§åœ¨é€æ¼¸æˆç†Ÿã€‚" />
    <button onclick="generate()">ğŸ”® ç”Ÿæˆå»ºè­°</button>
  </div>

  <div class="suggestion-box">
    <h3>ç”Ÿæ´»å»ºè­°</h3>
    <div id="suggest-life">å°šæœªç”Ÿæˆ</div>
  </div>

  <div class="suggestion-box">
    <h3>æƒ…ç·’å»ºè­°</h3>
    <div id="suggest-emotion">å°šæœªç”Ÿæˆ</div>
  </div>

  <div class="suggestion-box">
    <h3>å¥åº·å»ºè­°</h3>
    <div id="suggest-health">å°šæœªç”Ÿæˆ</div>
  </div>

  <!-- WebLLM -->
  <script type="module">
    import { ChatWorkerClient } from 'https://esm.sh/@mlc-ai/web-llm';

    let client;
    let isReady = false;

    async function initLLM() {
      client = new ChatWorkerClient();
      await client.reload('phi-2', undefined);
      isReady = true;
    }

    async function generate() {
      if (!isReady) {
        alert("æ¨¡å‹å°šæœªåŠ è¼‰å®Œæˆï¼Œè«‹ç¨å€™å¹¾ç§’å†è©¦");
        return;
      }

      const input = document.getElementById("input-prompt").value.trim();
      const systemPrompt = `ä½ æ˜¯ä¸€ä½æº«æŸ”çš„å»ºè­°è€…ã€‚è«‹é‡å°ä½¿ç”¨è€…è¼¸å…¥çš„ä¸­æ–‡èªå¥ï¼Œçµ¦å‡ºä¸‰æ¢ç°¡çŸ­å»ºè­°ï¼ˆæ¯æ¢å»ºè­°ä¸è¶…é30å€‹ä¸­æ–‡å­—ï¼‰ï¼ŒåŒ…å«ï¼š
1. ç”Ÿæ´»å»ºè­°
2. æƒ…ç·’å»ºè­°
3. å¥åº·å»ºè­°`;

      const finalPrompt = `ä½¿ç”¨è€…èªªï¼šã€Œ${input}ã€\nè«‹çµ¦å‡ºä¸‰æ¢å…·é«”å»ºè­°ï¼ˆç”Ÿæ´»ã€æƒ…ç·’ã€å¥åº·ï¼‰ï¼Œæ¯æ¢30å­—å…§ã€‚`;

      const reply = await client.generate(systemPrompt, finalPrompt);

      const lines = reply.split(/\n|\d\.|\â€¢/).map(l => l.trim()).filter(x => x.length > 5);

      document.getElementById("suggest-life").textContent = lines[0] || "ç„¡æ³•å–å¾—";
      document.getElementById("suggest-emotion").textContent = lines[1] || "ç„¡æ³•å–å¾—";
      document.getElementById("suggest-health").textContent = lines[2] || "ç„¡æ³•å–å¾—";
    }

    initLLM(); // é å…ˆè¼‰å…¥
  </script>
</body>
</html>
